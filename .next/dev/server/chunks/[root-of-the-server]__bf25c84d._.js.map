{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/BilliardOS/app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient();\r\n};\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClientSingleton | undefined;\r\n};\r\n\r\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton();\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY;AAC3B;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/BilliardOS/app/src/app/api/tables/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { z } from \"zod\";\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nconst createTableSchema = z.object({\r\n    id: z.string().min(1),\r\n    name: z.string().min(1),\r\n    type: z.enum(['REGULAR', 'VIP']),\r\n    hourlyRate: z.number().min(0),\r\n});\r\n\r\nexport async function GET() {\r\n    try {\r\n        // Fetch tables with active sessions\r\n        const tables = await prisma.table.findMany({\r\n            include: {\r\n                sessions: {\r\n                    where: {\r\n                        OR: [\r\n                            { status: \"OPEN\" },\r\n                            { status: \"PAUSED\" }\r\n                        ]\r\n                    },\r\n                    take: 1,\r\n                    include: {\r\n                        member: { select: { fullName: true, memberCode: true } },\r\n                        orders: {\r\n                            include: { items: true }\r\n                        }\r\n                    }\r\n                },\r\n            },\r\n            orderBy: { id: \"asc\" },\r\n        });\r\n\r\n        const formattedTables = tables.map((table) => {\r\n            const activeSession = table.sessions[0];\r\n\r\n            let currentBill = 0;\r\n            let durationMinutes = 0;\r\n\r\n            if (activeSession) {\r\n                const start = new Date(activeSession.startTime).getTime();\r\n                const now = new Date().getTime();\r\n                durationMinutes = Math.floor((now - start) / (1000 * 60));\r\n\r\n                // Calculate Bill: (Duration / 60) * HourlyRate\r\n                const hours = durationMinutes / 60;\r\n                currentBill = Math.ceil(hours * Number(table.hourlyRate));\r\n            }\r\n\r\n            return {\r\n                id: table.id,\r\n                name: table.name,\r\n                type: table.type,\r\n                status: table.status,\r\n                hourlyRate: Number(table.hourlyRate),\r\n                // Flatten billing data for frontend\r\n                duration: durationMinutes,\r\n                currentBill,\r\n                activeSession: activeSession ? {\r\n                    id: activeSession.id,\r\n                    customerName: activeSession.customerName || activeSession.member?.fullName || \"Guest\",\r\n                    member: activeSession.member,\r\n                    startTime: activeSession.startTime,\r\n                    endTime: (activeSession as any).endTime || null, // For fixed hour packages\r\n                    status: activeSession.status,\r\n                    durationMinutes,\r\n                    currentBill,\r\n                    orders: activeSession.orders || []\r\n                } : null\r\n            };\r\n        });\r\n\r\n        return NextResponse.json({ success: true, data: formattedTables });\r\n    } catch (error) {\r\n        console.error(\"Get tables error:\", error);\r\n        return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\n// CREATE new table\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { id, name, type, hourlyRate } = createTableSchema.parse(body);\r\n\r\n        // Check if table ID exists\r\n        const existing = await prisma.table.findUnique({ where: { id } });\r\n        if (existing) {\r\n            return NextResponse.json({ error: \"Table ID already exists\" }, { status: 400 });\r\n        }\r\n\r\n        const table = await prisma.table.create({\r\n            data: {\r\n                id,\r\n                name,\r\n                type,\r\n                hourlyRate,\r\n                status: 'AVAILABLE',\r\n            },\r\n        });\r\n\r\n        return NextResponse.json({ success: true, data: table }, { status: 201 });\r\n    } catch (error) {\r\n        console.error(\"Create table error:\", error);\r\n        if (error instanceof z.ZodError) {\r\n            return NextResponse.json({ error: \"Validation error\", details: error.issues }, { status: 400 });\r\n        }\r\n        return NextResponse.json({ error: \"Internal server error\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}