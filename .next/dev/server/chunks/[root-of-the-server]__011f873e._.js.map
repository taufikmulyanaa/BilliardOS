{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/BilliardOS/app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prismaClientSingleton = () => {\r\n    return new PrismaClient();\r\n};\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n    prisma: PrismaClientSingleton | undefined;\r\n};\r\n\r\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton();\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,6IAAY;AAC3B;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Lenovo/Documents/BilliardOS/app/src/app/api/tables/transfer/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { fromTableId, toTableId } = body;\r\n\r\n        if (!fromTableId || !toTableId) {\r\n            return NextResponse.json({ error: \"Missing table IDs\" }, { status: 400 });\r\n        }\r\n\r\n        const result = await prisma.$transaction(async (tx) => {\r\n            // 1. Validate Source Table (Must be ACTIVE and have open session)\r\n            const fromTable = await tx.table.findUnique({\r\n                where: { id: fromTableId },\r\n                include: { sessions: { where: { status: 'OPEN' } } }\r\n            });\r\n\r\n            if (!fromTable || fromTable.status !== 'ACTIVE' || fromTable.sessions.length === 0) {\r\n                throw new Error(\"Source table is not active or has no open session\");\r\n            }\r\n\r\n            const session = fromTable.sessions[0];\r\n\r\n            // 2. Validate Target Table (Must be AVAILABLE)\r\n            const toTable = await tx.table.findUnique({ where: { id: toTableId } });\r\n            if (!toTable || toTable.status !== 'AVAILABLE') {\r\n                throw new Error(\"Target table is not available\");\r\n            }\r\n\r\n            // 3. Move Session\r\n            await tx.tableSession.update({\r\n                where: { id: session.id },\r\n                data: { tableId: toTableId }\r\n            });\r\n\r\n            // 4. Update Table Statuses\r\n            // Source becomes CLEANING (standard practice)\r\n            await tx.table.update({\r\n                where: { id: fromTableId },\r\n                data: { status: 'CLEANING' }\r\n            });\r\n\r\n            // Target becomes ACTIVE\r\n            await tx.table.update({\r\n                where: { id: toTableId },\r\n                data: { status: 'ACTIVE' }\r\n            });\r\n\r\n            return { success: true };\r\n        });\r\n\r\n        return NextResponse.json({ success: true, data: result });\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Transfer error:\", error);\r\n        return NextResponse.json({ error: error.message || \"Transfer failed\" }, { status: 400 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,GAAG;QAEnC,IAAI,CAAC,eAAe,CAAC,WAAW;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,SAAS,MAAM,gIAAM,CAAC,YAAY,CAAC,OAAO;YAC5C,kEAAkE;YAClE,MAAM,YAAY,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC;gBACxC,OAAO;oBAAE,IAAI;gBAAY;gBACzB,SAAS;oBAAE,UAAU;wBAAE,OAAO;4BAAE,QAAQ;wBAAO;oBAAE;gBAAE;YACvD;YAEA,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,YAAY,UAAU,QAAQ,CAAC,MAAM,KAAK,GAAG;gBAChF,MAAM,IAAI,MAAM;YACpB;YAEA,MAAM,UAAU,UAAU,QAAQ,CAAC,EAAE;YAErC,+CAA+C;YAC/C,MAAM,UAAU,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE,IAAI;gBAAU;YAAE;YACrE,IAAI,CAAC,WAAW,QAAQ,MAAM,KAAK,aAAa;gBAC5C,MAAM,IAAI,MAAM;YACpB;YAEA,kBAAkB;YAClB,MAAM,GAAG,YAAY,CAAC,MAAM,CAAC;gBACzB,OAAO;oBAAE,IAAI,QAAQ,EAAE;gBAAC;gBACxB,MAAM;oBAAE,SAAS;gBAAU;YAC/B;YAEA,2BAA2B;YAC3B,8CAA8C;YAC9C,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;gBAClB,OAAO;oBAAE,IAAI;gBAAY;gBACzB,MAAM;oBAAE,QAAQ;gBAAW;YAC/B;YAEA,wBAAwB;YACxB,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC;gBAClB,OAAO;oBAAE,IAAI;gBAAU;gBACvB,MAAM;oBAAE,QAAQ;gBAAS;YAC7B;YAEA,OAAO;gBAAE,SAAS;YAAK;QAC3B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAO;IAE3D,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAkB,GAAG;YAAE,QAAQ;QAAI;IAC1F;AACJ"}}]
}